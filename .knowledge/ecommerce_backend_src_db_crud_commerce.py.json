{"is_source_file": true, "format": "Python", "description": "This file contains CRUD functions for shopping cart and order management in an e-commerce backend, utilizing SQLAlchemy ORM models and FastAPI exceptions. It handles operations such as retrieving, creating, updating, and deleting cart and order data, as well as managing inventory and calculating totals.", "external_files": ["src/db/models/commerce.py", "src/db/models/catalog.py"], "external_methods": ["db.execute", "db.get", "db.add", "db.commit", "db.refresh", "db.delete", "db.query", "db.flush"], "published": ["get_or_create_active_cart", "get_cart_with_items", "add_to_cart", "update_cart_item", "remove_from_cart", "checkout_cart", "list_user_orders"], "classes": [{"name": "Cart", "description": "Represents a shopping cart associated with a user and containing multiple cart items."}, {"name": "CartItem", "description": "Represents an item within a shopping cart, linked to a product."}, {"name": "Order", "description": "Represents a finalized purchase order containing order details and associated items."}, {"name": "OrderItem", "description": "Represents an item within an order, linked to a product with specific quantity and price."}, {"name": "Product", "description": "Represents a product in the catalog, including stock, price, and currency details."}], "methods": [{"name": "Cart get_or_create_active_cart(db: Session, user_id: int)", "description": "Retrieve the user's active cart or create a new one if none exists.", "scope": "", "scopeKind": ""}, {"name": "Cart get_cart_with_items(db: Session, user_id: int)", "description": "Retrieve the current active cart along with its items for a user.", "scope": "", "scopeKind": ""}, {"name": "Cart add_to_cart(db: Session, user_id: int, product_id: int, quantity: int = 1)", "description": "Add a specified product and quantity to the user's active cart, checking stock constraints.", "scope": "", "scopeKind": ""}, {"name": "Cart update_cart_item(db: Session, user_id: int, product_id: int, quantity: int)", "description": "Update the quantity of a cart item, or remove it if the quantity is non-positive, with stock validation.", "scope": "", "scopeKind": ""}, {"name": "Cart remove_from_cart(db: Session, user_id: int, product_id: int)", "description": "Remove a specific product from the user's cart.", "scope": "", "scopeKind": ""}, {"name": "Order checkout_cart(db: Session, user_id: int)", "description": "Convert the active cart into an order, deduct stock, and mark the cart as checked out.", "scope": "", "scopeKind": ""}, {"name": "list_user_orders(db: Session, user_id: int)", "description": "Retrieve all orders of a user, sorted by most recent.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,str] _calculate_cart_totals(db: Session, cart: Cart)", "description": "Compute total price in cents and currency for the cart items.", "scope": "", "scopeKind": ""}, {"name": "Optional[CartItem] _get_cart_item(db: Session, cart_id: int, product_id: int)", "description": "Fetch a specific cart item based on cart ID and product ID.", "scope": "", "scopeKind": ""}], "calls": ["select(Cart).where", "db.execute", "db.get", "db.add", "db.commit", "db.refresh", "db.delete", "db.query", "db.flush", "select(CartItem).where", "select(CartItem).where", "select(CartItem).where", "select(CartItem).where", "db.get(Product, ...)", "db.get(Product, ...)", "db.get(Product, ...)", "db.get(Product, ...)"], "search-terms": ["commerce.py", "shopping cart operations", "order checkout", "inventory management", "SQLAlchemy CRUD", "FastAPI HTTPException handling", "cart item management"], "state": 2, "file_id": 29, "knowledge_revision": 69, "git_revision": "", "revision_history": [{"64": ""}, {"69": ""}], "ctags": [{"_type": "tag", "name": "_calculate_cart_totals", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def _calculate_cart_totals(db: Session, cart: Cart) -> Tuple[int, str]:$/", "language": "Python", "typeref": "typename:Tuple[int,str]", "kind": "function", "signature": "(db: Session, cart: Cart)"}, {"_type": "tag", "name": "_get_cart_item", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def _get_cart_item(db: Session, cart_id: int, product_id: int) -> Optional[CartItem]:$/", "language": "Python", "typeref": "typename:Optional[CartItem]", "kind": "function", "signature": "(db: Session, cart_id: int, product_id: int)"}, {"_type": "tag", "name": "add_to_cart", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def add_to_cart(db: Session, user_id: int, product_id: int, quantity: int = 1) -> Cart:$/", "language": "Python", "typeref": "typename:Cart", "kind": "function", "signature": "(db: Session, user_id: int, product_id: int, quantity: int = 1)"}, {"_type": "tag", "name": "checkout_cart", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def checkout_cart(db: Session, user_id: int) -> Order:$/", "language": "Python", "typeref": "typename:Order", "kind": "function", "signature": "(db: Session, user_id: int)"}, {"_type": "tag", "name": "get_cart_with_items", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def get_cart_with_items(db: Session, user_id: int) -> Cart:$/", "language": "Python", "typeref": "typename:Cart", "kind": "function", "signature": "(db: Session, user_id: int)"}, {"_type": "tag", "name": "get_or_create_active_cart", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def get_or_create_active_cart(db: Session, user_id: int) -> Cart:$/", "language": "Python", "typeref": "typename:Cart", "kind": "function", "signature": "(db: Session, user_id: int)"}, {"_type": "tag", "name": "list_user_orders", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def list_user_orders(db: Session, user_id: int):$/", "language": "Python", "kind": "function", "signature": "(db: Session, user_id: int)"}, {"_type": "tag", "name": "remove_from_cart", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def remove_from_cart(db: Session, user_id: int, product_id: int) -> Cart:$/", "language": "Python", "typeref": "typename:Cart", "kind": "function", "signature": "(db: Session, user_id: int, product_id: int)"}, {"_type": "tag", "name": "update_cart_item", "path": "/home/kavia/workspace/code-generation/techgear-e-commerce-platform-215921-215931/ecommerce_backend/src/db/crud/commerce.py", "pattern": "/^def update_cart_item(db: Session, user_id: int, product_id: int, quantity: int) -> Cart:$/", "language": "Python", "typeref": "typename:Cart", "kind": "function", "signature": "(db: Session, user_id: int, product_id: int, quantity: int)"}], "hash": "2ebb02e06510eaadde2fbaf885901770", "format-version": 4, "code-base-name": "ecommerce_backend", "filename": "ecommerce_backend/src/db/crud/commerce.py"}